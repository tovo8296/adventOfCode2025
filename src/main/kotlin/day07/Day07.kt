package day07

import util.Coord
import util.findCoord
import util.get
import util.height
import util.width

val Splitter = '^'
val Empty = '.'

fun main() {
    val map = input.lines().map { it.toList() }
    val start = map.findCoord { it == 'S' }!!
    var beams = setOf(start.x)
    var split = 0
    (1 until map.height).forEach {
       val result = continueBeams(map, it, beams)
        beams = result.first
        split += result.second
    }

    println("Splits: $split")
}

fun continueBeams(map: List<List<Char>>, y: Int, beams: Set<Int>): Pair<Set<Int>, Int> {
    val newBeams = mutableSetOf<Int>()
    var split = 0
    beams.forEach { x ->
        val c = map.get(Coord(x, y))
        when (c) {
            Empty -> newBeams.add(x)
            Splitter -> {
                split++
                if (x > 0) {
                    newBeams.add(x - 1)
                }
                if (x < map.width - 1) {
                    newBeams.add(x + 1)
                }
            }
            else -> throw RuntimeException("Unknown field '$c'")
        }
    }
    return Pair(newBeams, split)
}



val input = """
......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^.^.^.^...................................................................
.............................................................................................................................................
..................................................................^.^.^.^.^..................................................................
.............................................................................................................................................
.................................................................^.^...^.^.^.................................................................
.............................................................................................................................................
................................................................^...^...^.^.^................................................................
.............................................................................................................................................
...............................................................^.^...^.^.^...^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^.....^.^..............................................................
.............................................................................................................................................
.............................................................^.....^.^.^.^...^.^.............................................................
.............................................................................................................................................
............................................................^.^.^...^.^.^.^.^.^.^............................................................
.............................................................................................................................................
...........................................................^...^.^.^.^...^...^...^...........................................................
.............................................................................................................................................
..........................................................^.^.^.^.^.^.....^.^.^...^..........................................................
.............................................................................................................................................
.........................................................^...^.^.......^...^.......^.........................................................
.............................................................................................................................................
........................................................^.^...^.^.^.^.^.....^...^.^.^........................................................
.............................................................................................................................................
.......................................................^...^...^...^.^...^.^.^.^...^.^.......................................................
.............................................................................................................................................
......................................................^.^.^.^.^...^.^.^...^.^.^.^.^...^......................................................
.............................................................................................................................................
.....................................................^.^.^.^.....^...^.........^.^...^.^.....................................................
.............................................................................................................................................
....................................................^.^.^.^.^.^.^.^.^...^.^.^.....^...^.^....................................................
.............................................................................................................................................
...................................................^...^.^...^.^...^.^.^.^.^...^.^.^.^.^.^...................................................
.............................................................................................................................................
..................................................^.....^.^.^...^.^.....^.^...^.^.^.^.^.^.^..................................................
.............................................................................................................................................
.................................................^.^.^...^.....^...^...^.^.^.^.^.^.^.^.^...^.................................................
.............................................................................................................................................
................................................^.^...^...^.^...^.^.^...^.^.....^...^.....^.^................................................
.............................................................................................................................................
...............................................^.^.^...^.^.....^...^...^...^.^...^.^.^.......^...............................................
.............................................................................................................................................
..............................................^...^.^...^.......^.^.^.^.^.^.^.^.^...^...^.....^..............................................
.............................................................................................................................................
.............................................^...^.^.....^.......^.^.^.^.^.^...^.^.^.^.....^...^.............................................
.............................................................................................................................................
............................................^.^.^.........^.^.....^.^.^.^.^...^.^.^.^.^...^.....^............................................
.............................................................................................................................................
...........................................^.^.^.^...^.....^.^.^.^.^...^...^.^.....^...^...^.^.^.^...........................................
.............................................................................................................................................
..........................................^.....^.^.^.^.^.^...^.....^.^.....^...^...^.^.^.^.^...^.^..........................................
.............................................................................................................................................
.........................................^.^...^.^.....^.^...^.^.^.^.^.^.^.^.^.^...^.....^.....^.^.^.........................................
.............................................................................................................................................
........................................^.....^.^.^.^.^.^.^...^...^.^.^.^.......^.^.^.^.^.^.^.^.^.^.^........................................
.............................................................................................................................................
.......................................^.^.^.^.^.^.^.^...^.^...^.^.^.^...^...^.....^.^.^...^.^...^.^.^.......................................
.............................................................................................................................................
......................................^.......^.^.........^...^.............^.^.^.^...^.^.^.^.^.^.^.^.^......................................
.............................................................................................................................................
.....................................^.^.^...^.^.^.^.....^.^.^...^.^.^.^.....^.^.^.^...^.......^.^...^.^.....................................
.............................................................................................................................................
....................................^...^.^...^.^.^...^.....^...^.......^.^.......^...^...^.^.^.^...^...^....................................
.............................................................................................................................................
...................................^.^.^.^.^.......^.^...^.^...^.^...^.^...^...^.^.^...^.^.^.^.^.^.^.^.^.^...................................
.............................................................................................................................................
..................................^.........^.^.^.^.^...^.^.^...^.^.^...^.^.^.^...^...^.^.^.....^...^.^.^.^..................................
.............................................................................................................................................
.................................^.^.^...^...^.^.....^.^.^.^...^.^.^.^.^.^.^...^...^.^.^...^.^.^.^...^.^.^.^.................................
.............................................................................................................................................
................................^.^.....^...^.....^...^.^...^.^.^.^...^...^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^................................
.............................................................................................................................................
...............................^...^.^...^.^.^...^...^.^.^.^.^.^...^.^.^.^...^.^.^.^.^...^...^...^.^.^.....^.^...............................
.............................................................................................................................................
..............................^.^.....^.^.^.^.....^.^.^.....^.^.^.^.^.^.......^...^.^.^.^.^...^.^.^.^.^.^.^.^.^..............................
.............................................................................................................................................
.............................^.^.....^...^.^.^.......^.^...^.^.^...^...^.^...^...^.^...^.^.^.^.^.^.^.^...^.^...^.............................
.............................................................................................................................................
............................^.....^.^...^.^.^.......^.^.^.^.......^.^.^.^.^.^.^...^.^.^.^...^...^.......^.^.^.^.^............................
.............................................................................................................................................
...........................^.^.^...^...^.^.^.^...^.^.^.^.^.....^...^...^.....^...^.^.^.^.^.........^.^.....^.^.^.^...........................
.............................................................................................................................................
..........................^.^...^.^...^.^.^.^.......^.^.^.^.^...^.^.....^.^.^.....^.....^...^.......^.^.^.^.^.....^..........................
.............................................................................................................................................
.........................^.^.^.^.....^.^...^.^.^.^.^.^.^.^...^.^.^.....^.^.^...^.^...^.^...^...^...^...^.^.^.^...^.^.........................
.............................................................................................................................................
........................^.^.^...^.^.^.^...^.....^...^.^.^.^.^.^...^.....^.^.^.^.^.^...^...^.^...........^...^...^...^........................
.............................................................................................................................................
.......................^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.......^.^.^.^.^.^...^...^...^.^.^.^.^.......^.^.^.^.^.^.^.......................
.............................................................................................................................................
......................^.......^.^.^.^...^.^...^.^...^.^...^.^.^.^.^...^.^.^...^...^.^...^...^.^.^.^.^.^.^.^.^.....^.^.^......................
.............................................................................................................................................
.....................^...^.....^.^.....^.^.^.^...^.^.^.....^.....^.^.^...^...^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.....................
.............................................................................................................................................
....................^...^...^.^.^.^...^.^...^.^.^.^...^...^.^.^.^...^.^.^.^.^...^.^.......^.^.^.^...^...^.....^.^.....^.^....................
.............................................................................................................................................
...................^...^.^.^.^...^...^.^.....^...^.^.^.^.^.^.^.^.^.^.....^.^...^.....^...^.^...^.^...^.^.^.^.^...^.^...^.^...................
.............................................................................................................................................
..................^.^.....^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.....^.^.^.^...^.^...^.^.^.^.^..................
.............................................................................................................................................
.................^.^...^.^.^.^.^.^.^.^.^...^.^.....^.....^.^.^.^...^.^.^.^...^...^...^.^.^.^.^.^.^.......^.....^.^.....^...^.................
.............................................................................................................................................
................^.^.^.........^...^.^...^.^.^.^.^.^...^...^...^.^.^...^.^.......^.^.^...^...^.^.^.^.^.^...^...^.....^.^.....^................
.............................................................................................................................................
...............^.^.......^.^.^.^...^.^.^...^.^...^.^.^.^...^.....^.^.....^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.....^.^...............
.............................................................................................................................................
..............^.^.^.^...^.....^.^.^.^.^.^...^...^.^.^.^...^.^.....^.^...^.....^.^...^...^...^.^.^...^.^.....^...^.^.^.^.^.^.^.^..............
.............................................................................................................................................
.............^.^.^.^.^.^.^.^.^.....^...^...^...^.......^.^.^...^...^...^.^...^...^.....^.^.......^.^.....^...^...^.....^.^.^.^.^.............
.............................................................................................................................................
............^.^.......^.....^.^.^.^.^.^.^.^.^.^.....^.^.^...^.^.^.^.^.^...^.......^.^.^...^...^...^...........^.^.^.^...^...^.^.^............
.............................................................................................................................................
...........^...^.^.....^.^.^.^.^.^...^.....^...^...^.^.^.^.^.^...^.^.^.^.^.^.^...^.....^.^.^.....^...^.^.^.^.....^.^.^.^.......^.^...........
.............................................................................................................................................
..........^.^...^...^.^.^.^.^.^.....^.........^...^.^.^.^.^.^...^.^.^.........^.^.^.^.^...^...^.^.^.^.^...^.^.^.^...^.^.^.^.^...^.^..........
.............................................................................................................................................
.........^.^.^...^.......^.^.^.^.^.....^...^.^...^...^.^...^...^...^.^.^.^.^.^.^.^.^.^.^.....^...^.^.^.....^...^.^.^.^.....^...^.^.^.........
.............................................................................................................................................
........^.^...^.^.^.^...^...^.....^...^.^.^.....^.^...^.^.^.^.^...^.....^...^.^...^.^.....^.....^.^.^.^...^.^.....^.^.^.....^.^.^.^.^........
.............................................................................................................................................
.......^.^.^.^.....^.........^...^.........^.^.....^.^.^.^.^.^.....^.^.^...^.^...^.^.^.^.^.^.....^.^.^.^.^.^...^.......^.^...^.^.^.^.^.......
.............................................................................................................................................
......^.^.^.....^.^.^.^.^.^...^.^.....^.^.^.^.^...^...^.^.........^.^...^.^.^.^.^.^.^.^.......^.^.^.^.....^...^...^...^...^.^.....^...^......
.............................................................................................................................................
.....^.^.....^.^.^.^.^.^.^.^.....^.^...^.^.^...^.....^...^.^.^.^.^.^...^.............^.^.^...^.^.....^.^.....^.^.....^.^.^.^.^.^.....^.^.....
.............................................................................................................................................
....^.^.^.^.^...^.^...^.......^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^...^...^.....^.^.^...^.^...^.^.^...^.^...^.^.^....
.............................................................................................................................................
...^.^.^.^.^.^.....^...^...^.^...^...^.^...^.^...^.^.^.^.......^...^.^.^...^...^.^.^...^.^.^.^...^...^.^.^...^.^.^.^.^.^.^.^.^...^...^.^.^...
.............................................................................................................................................
..^.^.^...^.^.........^.^...^.^.^.^.^.......^.^.....^...^.....^...^...^...^.....^.^.^.....^...^.....^.......^.^.^...^.^.....^.^.....^.^.^.^..
.............................................................................................................................................
.^.^.^.^.^...^...^...^.^...^.^...^.^.^.^.....^.^.^.^.....^.^...^.^.^.^.^.^.^...........^.^.^.^.......^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^...^.
.............................................................................................................................................
""".trimIndent()